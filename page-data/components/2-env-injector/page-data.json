{"componentChunkName":"component---src-templates-docs-js","path":"/components/2-env-injector","result":{"data":{"site":{"siteMetadata":{"title":"Azure Key Vault to Kubernetes","docsLocation":"https://github.com/SparebankenVest/azure-key-vault-to-kubernetes/tree/master/docs/content"}},"mdx":{"fields":{"id":"0650f43e-dbb3-5ddd-a4c4-1fa18e969dd3","title":"Env Injector","slug":"/components/2-env-injector"},"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Env Injector\",\n  \"metaTitle\": \"Env Injector\",\n  \"metaDescription\": \"This is the meta description\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"The \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Azure Key Vault Env Injector\"), \" (Env Injector for short) is a Kubernetes Mutating Webhook that transparently injects Azure Key Vault secrets as environment variables into programs running in containers, without touching disk or in any other way expose the actual secret content outside the program.\"), mdx(\"p\", null, \"The Env Injector is developed using a Mutating Admission Webhook that triggers just before every Pod gets created. As with the Controller, the Env Injector relies on \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AzureKeyVaultSecret\"), \" resources to provide information about the Azure Key Vault secrets. \"), mdx(\"p\", null, \"The Env Injector will start processing containers containing one or more environment placeholders like below: \"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\"\n  }), \"env:\\n  - name: <name of environment variable>\\n    value: <name of AzureKeyVaultSecret>@azurekeyvault?<optional field query>\\n\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note: To allow cluster administrators some control over which Pods this Webhook gets triggered for, it must be enabled per namespace using the \", mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"azure-key-vault-env-injection\"), \" label\")), mdx(\"p\", null, \"It will start by injecting a init-container into the Pod. This init-container copies over the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"azure-keyvault-env\"), \" executable to a share volume between the init-container and the original container. It then changes either the CMD or ENTRYPOINT, depending on which was used by the original container, to use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"azure-keyvault-env\"), \" executable instead, and pass on the \\\"old\\\" command as parameters to this new executable. The init-container will then complete and the original container will start.\"), mdx(\"p\", null, \"When the original container starts it will execute the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"azure-keyvault-env\"), \" command which will download any Azure Key Vault secrets, identified by the environment placeholders above. The remaining step is for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"azure-keyvault-env\"), \" to execute the original command and params, pass on the updated environment variables with real secret values. This way all secrets gets injected transparently in-memory during container startup, and not reveal any secret content to the container spec, disk or logs.\"));\n}\n;\nMDXContent.isMDXComponent = true;","tableOfContents":{},"parent":{"relativePath":"components/2-env-injector.md"},"frontmatter":{"metaTitle":"Env Injector","metaDescription":"This is the meta description"}},"allMdx":{"edges":[{"node":{"fields":{"slug":"/authentication","title":"Authentication"}}},{"node":{"fields":{"slug":"/authorization","title":"Authorization"}}},{"node":{"fields":{"slug":"/components","title":"Components"}}},{"node":{"fields":{"slug":"/examples","title":"Examples"}}},{"node":{"fields":{"slug":"/how-it-works","title":"How it Works"}}},{"node":{"fields":{"slug":"/","title":"Introduction"}}},{"node":{"fields":{"slug":"/reference","title":"Reference"}}},{"node":{"fields":{"slug":"/setup","title":"Setup"}}},{"node":{"fields":{"slug":"/tasks","title":"Tasks"}}},{"node":{"fields":{"slug":"/components/1-controller","title":"Controller"}}},{"node":{"fields":{"slug":"/components/2-env-injector","title":"Env Injector"}}},{"node":{"fields":{"slug":"/components/3-when-to-use-which","title":"When to use which?"}}},{"node":{"fields":{"slug":"/tasks/0-prerequisites","title":"Prerequisites"}}},{"node":{"fields":{"slug":"/tasks/1-secret","title":"Get Secret"}}},{"node":{"fields":{"slug":"/tasks/2-certificate","title":"Get Certificate"}}},{"node":{"fields":{"slug":"/tasks/3-multi-value-secret","title":"Get Multi Value Secret"}}},{"node":{"fields":{"slug":"/tasks/4-signing-key","title":"Get Signing Key"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"0650f43e-dbb3-5ddd-a4c4-1fa18e969dd3"}}}