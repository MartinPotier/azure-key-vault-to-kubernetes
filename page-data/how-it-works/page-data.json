{"componentChunkName":"component---src-templates-docs-js","path":"/how-it-works","result":{"data":{"site":{"siteMetadata":{"title":"Azure Key Vault to Kubernetes","docsLocation":"https://github.com/SparebankenVest/azure-key-vault-to-kubernetes/tree/master/docs/content"}},"mdx":{"fields":{"id":"f493f487-bef9-56d7-b86f-b5bc79e303b1","title":"How it Works","slug":"/how-it-works"},"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"How it Works\",\n  \"metaTitle\": \"how it works\",\n  \"metaDescription\": \"Learn about the inner workings of akv2k8s.\",\n  \"index\": 80\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h3\", null, \"Controller\"), mdx(\"p\", null, \"The Controller works like this:\"), mdx(\"p\", null, \"By creating a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AzureKeyVaultSecret\"), \" resource (a Custom Resource Definition provided by this project) the Controller has everything needed to know which Azure Key Vault and Object it is going to sync.\"), mdx(\"p\", null, \"When created, the Controller kicks in and use the information to download the secret from Azure Key Vault and create a native Kubernetes secret containing the secret from Azure Key Vault.\"), mdx(\"p\", null, \"Periodically the Controller will poll Azure Key Vault for version changes of the secret and apply any changes to the Kubernetes native secret.\"), mdx(\"p\", null, \"See \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"#usage\"\n  }), \"Usage\"), \" for more details.\"), mdx(\"h3\", null, \"Env Injector\"), mdx(\"p\", null, \"The Env Injector is developed using a Mutating Admission Webhook that triggers just before every Pod gets created. As with the Controller, the Env Injector relies on \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AzureKeyVaultSecret\"), \" resources to provide information about the Azure Key Vault secrets. \"), mdx(\"p\", null, \"The Env Injector will start processing containers containing one or more environment placeholders like below: \"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\"\n  }), \"env:\\n  - name: <name of environment variable>\\n    value: <name of AzureKeyVaultSecret>@azurekeyvault?<optional field query>\\n...\\n\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note: To allow cluster administrators some control over which Pods this Webhook gets triggered for, it must be enabled per namespace using the \", mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"azure-key-vault-env-injection\"), \" label\")), mdx(\"p\", null, \"It will start by injecting a init-container into the Pod. This init-container copies over the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"azure-keyvault-env\"), \" executable to a share volume between the init-container and the original container. It then changes either the CMD or ENTRYPOINT, depending on which was used by the original container, to use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"azure-keyvault-env\"), \" executable instead, and pass on the \\\"old\\\" command as parameters to this new executable. The init-container will then complete and the original container will start.\"), mdx(\"p\", null, \"When the original container starts it will execute the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"azure-keyvault-env\"), \" command which will download any Azure Key Vault secrets, identified by the environment placeholders above. The remaining step is for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"azure-keyvault-env\"), \" to execute the original command and params, pass on the updated environment variables with real secret values. This way all secrets gets injected transparently in-memory during container startup, and not reveal any secret content to the container spec, disk or logs.\"));\n}\n;\nMDXContent.isMDXComponent = true;","tableOfContents":{"items":[{"url":"#controller","title":"Controller"},{"url":"#env-injector","title":"Env Injector"}]},"parent":{"relativePath":"how-it-works.md"},"frontmatter":{"metaTitle":"how it works","metaDescription":"Learn about the inner workings of akv2k8s.","index":80}},"allMdx":{"edges":[{"node":{"fields":{"slug":"/authentication","title":"Authentication"},"frontmatter":{"index":30}}},{"node":{"fields":{"slug":"/authorization","title":"Authorization"},"frontmatter":{"index":40}}},{"node":{"fields":{"slug":"/components","title":"Components"},"frontmatter":{"index":20}}},{"node":{"fields":{"slug":"/examples","title":"Examples"},"frontmatter":{"index":60}}},{"node":{"fields":{"slug":"/how-it-works","title":"How it Works"},"frontmatter":{"index":80}}},{"node":{"fields":{"slug":"/","title":"Introduction"},"frontmatter":{"index":1}}},{"node":{"fields":{"slug":"/installation","title":"Installation"},"frontmatter":{"index":10}}},{"node":{"fields":{"slug":"/known-issues","title":"Known Issues"},"frontmatter":{"index":100}}},{"node":{"fields":{"slug":"/reference","title":"Reference"},"frontmatter":{"index":70}}},{"node":{"fields":{"slug":"/troubleshooting","title":"Troubleshooting"},"frontmatter":{"index":90}}},{"node":{"fields":{"slug":"/tutorials","title":"Tutorials"},"frontmatter":{"index":50}}},{"node":{"fields":{"slug":"/components/1-controller","title":"Controller"},"frontmatter":{"index":21}}},{"node":{"fields":{"slug":"/components/2-env-injector","title":"Env Injector"},"frontmatter":{"index":22}}},{"node":{"fields":{"slug":"/tutorials/0-prerequisites","title":"Prerequisites"},"frontmatter":{"index":51}}},{"node":{"fields":{"slug":"/components/3-when-to-use-which","title":"When to use which?"},"frontmatter":{"index":23}}},{"node":{"fields":{"slug":"/tutorials/1-secret","title":"Get Secret"},"frontmatter":{"index":52}}},{"node":{"fields":{"slug":"/tutorials/2-certificate","title":"Get Certificate"},"frontmatter":{"index":53}}},{"node":{"fields":{"slug":"/tutorials/3-signing-key","title":"Get Signing Key"},"frontmatter":{"index":54}}},{"node":{"fields":{"slug":"/tutorials/4-multi-value-secret","title":"Get Multi Value Secret"},"frontmatter":{"index":55}}},{"node":{"fields":{"slug":"/tutorials/5-env-injector-pfx-certificate","title":"Inject PFX Certificate"},"frontmatter":{"index":56}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"f493f487-bef9-56d7-b86f-b5bc79e303b1"}}}